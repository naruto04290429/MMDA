<!doctype html>
<html lang="en">

<head>
    <title>DAGR Home</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

</head>

<body>


    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">DAGR</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="index.html">Home
                        <span class="sr-only"></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="reachquery.html">Reach Query
                        <span class="sr-only"></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="addFile.html">Add File
                        <span class="sr-only"></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="listing_category.php">Manage Categories
                        <span class="sr-only"></span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <br>

    <div class="container">

        <div class="row">

            <div class="col-lg-12">
                <div class="jumbotron jumbotron-fluid">
                    <div class="container">
                        <h3 class="display-3">DAGR</h3>
                        <hr>
                        <p class="lead">The following form satisfies a number of the required tasks.
                            <ul>
                                <li>Categorization. Although the management of sub-category is done somewher e else.</li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-lg-4">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Name</span>
                    <input type="text" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='search-file-name' onchange="showFiles()">
                </div>
                <br>
            </div>
            <div class="col-lg-4">
                <div class="input-group">

                    <span class="input-group-addon" id="basic-addon1">Category</span>
                    <input type="text" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='search-file-category' onchange="showFiles()" list="category_list">
                    <datalist id="category-list"></datalist>
                </div>
                <br>
            </div>
            <div class="col-lg-4">
                <div class="input-group">

                    <span class="input-group-addon" id="basic-addon1">Extension</span>
                    <input type="text" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='search-file-extension' onchange="showFiles()"
                        placeholder=".php">
                </div>
                <br>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Modified After</span>
                    <input type="datetime-local" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='search-modified-after'
                        onchange="showFiles()">
                </div>
                <br>
            </div>
            <div class="col-lg-6">
                <div class="input-group">

                    <span class="input-group-addon" id="basic-addon1">Modified Before</span>
                    <input type="datetime-local" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='search-modified-before'
                        onchange="showFiles()">

                </div>
                <br>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Minimum Size</span>
                    <input type="number" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='search-min-size' value="0"
                        onchange="showFiles()">
                </div>
                <br>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Maximum Size</span>
                    <input type="number" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='search-max-size' onchange="showFiles()">
                </div>
                <br>
            </div>
            <div class="col-lg-3">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Page Number</span>
                    <input type="number" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='page_number' min="1" value="1"
                        onchange="showFiles()">
                </div>

            </div>
            <div class="col-lg-3">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Results Per Page</span>
                    <input type="number" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='results_per_page' value="20"
                        min="20" max="100" onchange="showFiles()">
                </div>
                <br>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Tags</span>
                    <input type="text" class="form-control" aria-label="Name" aria-describedby="basic-addon1" id='tags' onchange="showFiles()"
                        placeholder="testag, oldfiles">
                </div>
                <br>
            </div>
            <div class="col-lg-3">
                <div class="form-check">
                    <label class="form-check-label">
                        <input class="form-check-input" type="checkbox" value="orphan" id="orphan" onchange="showFiles()"> Orphan (files with no parent)
                    </label>
                </div>
                <br>
            </div>
            <div class="col-lg-3">
                <label class="form-check-label">
                    <input class="form-check-input" type="checkbox" id="sterile" value="" onchange="showFiles()"> Sterile (files with no children)
                </label>
                <br>
            </div>
        </div>

    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div id="files" style="min-height:100vh;"></div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="deleteConfirmation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Are you sure you want to delete this DAGR?</h5>
                </div>
                <div class="model-body">
                    <div class="container-fluid">

                        <div class="row">
                            <div class="col-lg-12" id="notTHECHILDREN"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="shallowDelete()" data-dismiss="modal">Shallow Deletion</button>
                    <button type="button" class="btn btn-primary" onclick="deepDelete()" data-dismiss="modal">Deep Deletion</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

    <script>
        document.getElementById('search-modified-after').valueAsNumber = 0
        document.getElementById('search-modified-before').valueAsNumber = Date.now();
        document.getElementById('search-max-size').value = Number.MAX_SAFE_INTEGER;

        var guidToDelete = 0;

        function updateTags(guid, tagString) {
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                //console.log(this.responseText);
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                }
            };
            guidToDelete = guid
            xmlhttp.open("GET", "./actions/updateTags.php?GUID=" + guid + "&TagString=" + tagString, true);
            xmlhttp.send();
        }

        function deleteDAGR(guid) {
            $('#deleteConfirmation').modal();
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                //console.log(this.responseText);
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById('notTHECHILDREN').innerHTML = this.responseText;
                    console.log(this.responseText);
                    showFiles();
                }
            };
            guidToDelete = guid
            xmlhttp.open("GET", "./actions/findDaughters.php?GUID=" + guidToDelete, true);
            xmlhttp.send();
        }

        function shallowDelete() {
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                //console.log(this.responseText);
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                    showFiles();
                }
            };
            xmlhttp.open("GET", "./actions/deleteFile.php?GUID=" + guidToDelete, true);
            xmlhttp.send();
        }

        function deepDelete() {
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                //console.log(this.responseText);
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                    showFiles();
                }
            };
            xmlhttp.open("GET", "./actions/deepDeleteFile.php?GUID=" + guidToDelete, true);
            xmlhttp.send();
        }

        function updateCategory(guid, category) {
            console.log("TRY - update category for file" + guid + "to" + category);

            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                //console.log(this.responseText);
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                    console.log("SUCCESS - updated category for file" + guid + "to" + category);
                }
            };
            xmlhttp.open("GET", "./actions/categorizeFile.php?GUID=" + guid + "&Category=" + category, true);
            xmlhttp.send();
        }

        function updateName(guid, name) {

            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                //console.log(this.responseText);
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                    console.log("SUCCESS - updated name for file" + guid + "to" + name);
                }
            };
            xmlhttp.open("GET", "./actions/renameFile.php?GUID=" + guid + "&Name=" + name, true);
            xmlhttp.send();
        }

        function setupCategoryList() {
            var dataList = document.getElementById('json-datalist');

            
        }

        function showFiles() {

            document.getElementById("files").innerHTML =
                "<center><img src=\"https://i.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.webp\"></center>";

            filename = document.getElementById('search-file-name').value;
            category = document.getElementById('search-file-category').value;
            extension = document.getElementById('search-file-extension').value;

            modified_after = document.getElementById('search-modified-after').valueAsNumber / 1000;
            modified_before = document.getElementById('search-modified-before').valueAsNumber / 1000;

            min_size = document.getElementById('search-min-size').value;
            max_size = document.getElementById('search-max-size').value;

            orphan = document.getElementById('orphan').checked;
            sterile = document.getElementById('sterile').checked;

            page_number = document.getElementById('page_number').value;
            results_per_page = document.getElementById('results_per_page').value;

            tagString = document.getElementById('tags').value;

            console.log(tagString);

            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                //console.log(this.responseText);
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("files").innerHTML = this.responseText;
                }
            };
            xmlhttp.open("GET", "./actions/listFiles.php?Name=" + filename + "&Category=" + category +
                "&Extension=" +
                extension + "&After=" + modified_after + "&Before=" + modified_before + "&MinSize=" + min_size +
                "&MaxSize=" + max_size + "&Orphan=" + orphan + "&Sterile=" + sterile + "&Page=" + page_number +
                "&PerPage=" + results_per_page + "&TagString=" + tagString, true);
            xmlhttp.send();
        }
    

        showFiles();
    </script>


</body>

</html>